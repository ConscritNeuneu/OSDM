<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="888px" preserveAspectRatio="none" style="width:1334px;height:888px;" version="1.1" viewBox="0 0 1334 888" width="1334px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tdvbkktoh9zv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="64" x2="64" y1="40.2969" y2="881.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="598" x2="598" y1="40.2969" y2="881.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1012" x2="1012" y1="40.2969" y2="881.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1142" x2="1142" y1="40.2969" y2="881.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1265" x2="1265" y1="40.2969" y2="881.6172"/><rect fill="#FEFECE" filter="url(#f1tdvbkktoh9zv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="114" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="12" y="24.9951">API_Consumer</text><rect fill="#FEFECE" filter="url(#f1tdvbkktoh9zv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="120" x="536" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="543" y="24.9951">OSDM_Provider</text><rect fill="#FEFECE" filter="url(#f1tdvbkktoh9zv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="124" x="948" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="955" y="24.9951">Journey_Planner</text><rect fill="#FEFECE" filter="url(#f1tdvbkktoh9zv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="1086" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1093" y="24.9951">FareProvider1</text><rect fill="#FEFECE" filter="url(#f1tdvbkktoh9zv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="1209" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1216" y="24.9951">FareProvider2</text><rect fill="#EEEEEE" filter="url(#f1tdvbkktoh9zv)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1327" x="0" y="70.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1327" y1="70.8633" y2="70.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1327" y1="73.8633" y2="73.8633"/><rect fill="#EEEEEE" filter="url(#f1tdvbkktoh9zv)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="453" x="437" y="60.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="434" x="443" y="76.3638">Creating the trip collection &amp; getting the initial set of trips</text><polygon fill="#A80036" points="586,110.5625,596,114.5625,586,118.5625,590,114.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="592" y1="114.5625" y2="114.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489" x="71" y="109.4966">POST /Trips-offers-collection &lt;MUNCHEN-PARIS, 23/10/2021, 2 pax, dob, ...&gt;</text><polygon fill="#A80036" points="1000,139.6953,1010,143.6953,1000,147.6953,1004,143.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="1006" y1="143.6953" y2="143.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="390" x="605" y="138.6294">&lt;retrieve trips information based on API Consumer request&gt;</text><polygon fill="#A80036" points="609,168.8281,599,172.8281,609,176.8281,605,172.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603" x2="1011" y1="172.8281" y2="172.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="615" y="167.7622">&lt;trips information&gt;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="640" y1="201.9609" y2="201.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="640" x2="640" y1="201.9609" y2="214.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="599" x2="640" y1="214.9609" y2="214.9609"/><polygon fill="#A80036" points="609,210.9609,599,214.9609,609,218.9609,605,214.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="605" y="196.895">determine FareProvider for each segment</text><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="640" y1="244.0938" y2="244.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="640" x2="640" y1="244.0938" y2="257.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="599" x2="640" y1="257.0938" y2="257.0938"/><polygon fill="#A80036" points="609,253.0938,599,257.0938,609,261.0938,605,257.0938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="605" y="239.0278">create offer requests</text><polygon fill="#A80036" points="1130.5,282.2266,1140.5,286.2266,1130.5,290.2266,1134.5,286.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="1136.5" y1="286.2266" y2="286.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="605" y="281.1606">get offers</text><polygon fill="#A80036" points="609,311.3594,599,315.3594,609,319.3594,605,315.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603" x2="1141.5" y1="315.3594" y2="315.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="615" y="310.2935">request with trips</text><polygon fill="#A80036" points="1253.5,340.4922,1263.5,344.4922,1253.5,348.4922,1257.5,344.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="1259.5" y1="344.4922" y2="344.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="605" y="339.4263">get offers</text><polygon fill="#A80036" points="609,369.625,599,373.625,609,377.625,605,373.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603" x2="1264.5" y1="373.625" y2="373.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="615" y="368.5591">request with trips</text><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="640" y1="417.8906" y2="417.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="640" x2="640" y1="417.8906" y2="430.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="599" x2="640" y1="430.8906" y2="430.8906"/><polygon fill="#A80036" points="609,426.8906,599,430.8906,609,434.8906,605,430.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="605" y="397.6919">reconcile trips and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="605" y="412.8247">construct global offers</text><polygon fill="#A80036" points="75,456.0234,65,460.0234,75,464.0234,71,460.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="597" y1="460.0234" y2="460.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="510" x="81" y="454.9575">&lt;Trips-offers-Collection with list of references to tripOffers and scrolling tokens&gt;</text><rect fill="#EEEEEE" filter="url(#f1tdvbkktoh9zv)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1327" x="0" y="488.5898"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1327" y1="488.5898" y2="488.5898"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1327" y1="491.5898" y2="491.5898"/><rect fill="#EEEEEE" filter="url(#f1tdvbkktoh9zv)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="433" x="447" y="478.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="414" x="453" y="494.0903">Creating a booking based on one of the received offers</text><polygon fill="#A80036" points="586,528.2891,596,532.2891,586,536.2891,590,532.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="592" y1="532.2891" y2="532.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="71" y="527.2231">POST /bookings/ &lt;offerId= 8765&gt;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="640" y1="561.4219" y2="561.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="640" x2="640" y1="561.4219" y2="574.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="599" x2="640" y1="574.4219" y2="574.4219"/><polygon fill="#A80036" points="609,570.4219,599,574.4219,609,578.4219,605,574.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="605" y="556.356">create local booking 5678</text><polygon fill="#A80036" points="1130.5,599.5547,1140.5,603.5547,1130.5,607.5547,1134.5,603.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="1136.5" y1="603.5547" y2="603.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="605" y="598.4888">provisionally book offerpart1</text><polygon fill="#A80036" points="609,628.6875,599,632.6875,609,636.6875,605,632.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603" x2="1141.5" y1="632.6875" y2="632.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="615" y="627.6216">OK response (can vary per FareProvider)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="640" y1="661.8203" y2="661.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="640" x2="640" y1="661.8203" y2="674.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="599" x2="640" y1="674.8203" y2="674.8203"/><polygon fill="#A80036" points="609,670.8203,599,674.8203,609,678.8203,605,674.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="605" y="656.7544">add FareProvider booking to local booking</text><polygon fill="#A80036" points="1253.5,699.9531,1263.5,703.9531,1253.5,707.9531,1257.5,703.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="1259.5" y1="703.9531" y2="703.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="605" y="698.8872">provisionally book offerpart2</text><polygon fill="#A80036" points="609,729.0859,599,733.0859,609,737.0859,605,733.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603" x2="1264.5" y1="733.0859" y2="733.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="615" y="728.02">NOK response (can vary per FareProvider)</text><polygon fill="#A80036" points="1130.5,758.2188,1140.5,762.2188,1130.5,766.2188,1134.5,762.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="598" x2="1136.5" y1="762.2188" y2="762.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="605" y="757.1528">DELETE /Bookings/5678</text><polygon fill="#A80036" points="609,787.3516,599,791.3516,609,795.3516,605,791.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603" x2="1141.5" y1="791.3516" y2="791.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="615" y="786.2856">OK response (can vary per FareProvider)</text><rect fill="#EEEEEE" filter="url(#f1tdvbkktoh9zv)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1327" x="0" y="819.918"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1327" y1="819.918" y2="819.918"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1327" y1="822.918" y2="822.918"/><rect fill="#EEEEEE" filter="url(#f1tdvbkktoh9zv)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="380" x="473.5" y="809.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="361" x="479.5" y="825.4185">respond to API Consumer with an error message</text><polygon fill="#A80036" points="75,859.6172,65,863.6172,75,867.6172,71,863.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="597" y1="863.6172" y2="863.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="81" y="858.5513">400 NOK (JSon Problem object)</text><!--MD5=[56d921c3086d631259703d9296ff6909]
@startuml
hide footbox
== Creating the trip collection & getting the initial set of trips ==
API_Consumer -> OSDM_Provider: POST /Trips-offers-collection <MUNCHEN-PARIS, 23/10/2021, 2 pax, dob, ...>
OSDM_Provider -> Journey_Planner : <retrieve trips information based on API Consumer request>
Journey_Planner - -> OSDM_Provider : <trips information>
OSDM_Provider -> OSDM_Provider: determine FareProvider for each segment
OSDM_Provider -> OSDM_Provider : create offer requests
OSDM_Provider -> FareProvider1: get offers 
FareProvider1 - -> OSDM_Provider : request with trips
OSDM_Provider -> FareProvider2: get offers 
FareProvider2 - -> OSDM_Provider : request with trips
OSDM_Provider -> OSDM_Provider : reconcile trips and \nconstruct global offers
OSDM_Provider - -> API_Consumer: <Trips-offers-Collection with list of references to tripOffers and scrolling tokens>

== Creating a booking based on one of the received offers ==
API_Consumer -> OSDM_Provider: POST /bookings/ <offerId= 8765>
OSDM_Provider -> OSDM_Provider : create local booking 5678
OSDM_Provider -> FareProvider1: provisionally book offerpart1 
FareProvider1 - -> OSDM_Provider : OK response (can vary per FareProvider)
OSDM_Provider -> OSDM_Provider : add FareProvider booking to local booking
OSDM_Provider -> FareProvider2: provisionally book offerpart2 
FareProvider2 - -> OSDM_Provider : NOK response (can vary per FareProvider)

OSDM_Provider -> FareProvider1: DELETE /Bookings/5678
FareProvider1 - -> OSDM_Provider : OK response (can vary per FareProvider)

== respond to API Consumer with an error message ==
OSDM_Provider - -> API_Consumer: 400 NOK (JSon Problem object)
@enduml

PlantUML version 1.2020.22(Sun Dec 06 10:36:27 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>